<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Eugene Khvedchenya
|
Cloud image processing using OpenCV and Node.js</title><meta charset=utf-8><meta name=generator content="Hugo 0.98.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Eugene Khvedchenya"><meta name=description content="This article describe how to build and use OpenCV in a cloud environment with a front-end in node.js"><link rel=stylesheet href=/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=https://computer-vision-talks.com/post/2013-08-19-cloud-image-processing-using-opencv-and-node-js/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.560a26330d27ff44a44e83b53cd07a95d4230a65930d31c5c76a8d481e5b35bf.js integrity="sha256-VgomMw0n/0SkToO1PNB6ldQjCmWTDTHFx2qNSB5bNb8=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Cloud image processing using OpenCV and Node.js"><meta name=twitter:description content="This article describe how to build and use OpenCV in a cloud environment with a front-end in node.js"><meta property="og:title" content="Cloud image processing using OpenCV and Node.js"><meta property="og:description" content="This article describe how to build and use OpenCV in a cloud environment with a front-end in node.js"><meta property="og:type" content="article"><meta property="og:url" content="https://computer-vision-talks.com/post/2013-08-19-cloud-image-processing-using-opencv-and-node-js/"><meta property="article:section" content="post"><meta property="article:published_time" content="2013-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2013-08-19T00:00:00+00:00"><meta property="og:site_name" content="Computer Vision Talks"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"post","name":"Cloud image processing using OpenCV and Node.js","headline":"Cloud image processing using OpenCV and Node.js","alternativeHeadline":"","description":"
      This article describe how to build and use OpenCV in a cloud environment with a front-end in node.js


    ","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/computer-vision-talks.com\/post\/2013-08-19-cloud-image-processing-using-opencv-and-node-js\/"},"author":{"@type":"Person","name":"Eugene Khvedchenya"},"creator":{"@type":"Person","name":"Eugene Khvedchenya"},"accountablePerson":{"@type":"Person","name":"Eugene Khvedchenya"},"copyrightHolder":{"@type":"Person","name":"Eugene Khvedchenya"},"copyrightYear":"2013","dateCreated":"2013-08-19T00:00:00.00Z","datePublished":"2013-08-19T00:00:00.00Z","dateModified":"2013-08-19T00:00:00.00Z","publisher":{"@type":"Organization","name":"Eugene Khvedchenya","url":"https://computer-vision-talks.com/","logo":{"@type":"ImageObject","url":"https:\/\/computer-vision-talks.com\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/computer-vision-talks.com\/post\/2013-08-19-cloud-image-processing-using-opencv-and-node-js\/","wordCount":"910","genre":[],"keywords":["opencv","nodejs","cloudcv","cloud-computing"]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/4ECfkGJr_400x400.jpg alt="profile picture"><div class=sidebar__introduction-title><a href=/>Computer Vision Talks</a></div><div class=sidebar__introduction-description><p>A personal blog about Computer Vision, AI, Kaggle, Open-Source and research. You will never read this in books.</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/cvtalks/ target=_blank rel=noopener aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/cvtalks target=_blank rel=noopener aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/BloodAxe target=_blank rel=noopener aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=mailto:ekhvedchenya@computer-vision-talks.com target=_blank rel=noopener aria-label=E-Mail title=E-Mail><i class="fas fa-envelope fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Eugene Khvedchenya
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.9c062c557275acbaba71f0c7cd4024da3e3cc825d248bc4b2130811b0965330b.js integrity="sha256-nAYsVXJ1rLq6cfDHzUAk2j48yCXSSLxLITCBGwllMws=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-10687369-5","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/post/ title>Posts</a></li><li class=nav__list-item><a href=/open-source title>Open-Source</a></li><li class=nav__list-item><a href=/challenges title>Wins</a></li><li class=nav__list-item><a href=/publications title>Publications</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>Cloud Image Processing Using OpenCV and Node.js</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>Mon, Aug 19, 2013</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>5-minute read</span></li></ul><p>A long time ago i was playing with cloud-based image processing. The first reason why i didn&rsquo;t shared a reciple how to compile OpenCV as native app for windows azure cloud was trycky build process. It was too complicated and this tutorial will become outdated very quickly. The second one - Azure hosting wants a lot of money. So i put my research in this area on hold for better times.</p><p>And i think the time has come. You probably heard about Node.js - server-side asynchronous Java Script library. I have very small experience with Java-Script, but Node.js attracted me so strong i decided to study it. In this post i will describe how to connect Node.js and OpenCV together. On server-side OpenCV libary can be used for many things - generating CAPTCHA&rsquo;s recognizing scans, counting people in video streams.. So i beleive my tutorial will come in handy to people who is looking how to do image processing in the cloud environment.</p><p>Node.js is written in Java-script, and follows asynchronous programming model, where events and callbacks plays dominant role. OpenCV is a C++ library written in good old C and C++ and it don&rsquo;t bother with asynchronous and event-based programming model. Fortunately Node.js can interop with external modules written in C++. It&rsquo;s made via V8 engine which is a core of Node.js.</p><p></p><h2 id=disclaimer>Disclaimer</h2><p>I will be using Mac OS as host platform. Keep in mind this since some commands may differs for Ubuntu or Debian. <strong>Windows users</strong> - you aren&rsquo;t lucky ones. I had no luck to build Node and OpenCV on windows so far. Please, post your comments if you succeed to build OpenCV module for Node.</p><h2 id=prerequisites>Prerequisites</h2><p>In this tutorial we will need the following software:</p><ol><li><a href=https://developer.apple.com/xcode/>XCode</a></li><li><a href=http://www.cmake.org/>CMake</a></li><li><a href=http://nodejs.org>Node.js</a></li><li><a href=http://opencv.org>OpenCV</a></li></ol><p>I assume you already installed XCode and CMake. In next two sections we describe installation of Node.js and OpenCV.</p><h2 id=installing-nodejs>Installing Node.js</h2><p>To install Node.js i used <a href=http://www.macports.org/>macports</a> software package manager. It&rsquo;s very similar to <code>apt-get</code> command from Unix.</p><p><strong>This command will install latests stable Node.js:</strong></p><pre><code>sudo port install nodejs
</code></pre><p>After running this command your Node.js is ready to use. It&rsquo;s not mandatory to use macports, you can install it using homebrew or build Node from the sources. It&rsquo;s up to you and will not affect further steps.</p><p>Node.js can be extended by C++ Modules. This is a way to interop with OpenCV library. To use OpenCV from Node.js we have to write C++ Mobule that Node.js can use. To build this module a special build system is used. We install it via Node Package Manager using following command:</p><p><strong>This command will install a GYP build system:</strong></p><pre><code>sudo npm install -g node-gyp
</code></pre><p>Take a note on &ldquo;-g&rdquo; flag which means &ldquo;Install globally&rdquo;. By default npm installs new package to current directory.</p><p>On this step we are done with setting up Node.js.</p><h3 id=installing-opencv>Installing OpenCV</h3><p>OpenCV can be build as <strong>static</strong> or <strong>shared</strong>. I describe my experience using both options with Node.js:</p><h4 id=shared>Shared</h4><p>By default, macports install shared libraries that are linked at run-time during application load. I was able to build a bare miminum Node.js module, but when i run it i got dyld load error. Maybe it&rsquo;s necessary to tell Node somehow where to search for OpenCV libs. But i decided to put this on hold and build a static OpenCV instead.</p><blockquote><p>If you know how to fix this easily your comments and suggestions are welcome!</p></blockquote><h4 id=static>Static</h4><p>Building OpenCV as static libs is very trivial if you used CMake. Here is full stack of commands that clone latests OpenCV snapshot and build the final distribution package:</p><p>Upon completition you shoudl have a folder named <code>opencv-node-bin</code> with following contents:</p><h3 id=writing-your-first-c-module-for-nodejs>Writing your first C++ Module for Node.js</h3><p>It&rsquo;s actuall a very easy to interop between JavaScript and C++, since JS uses V8 engine which is written in C++ too. I used the <a href=http://nodejs.org/api/addons.html>official documentation</a> and <a href=https://github.com/kkaefer/node-cpp-modules>good examples</a> by Konstantin Käfer.</p><p>Node.js uses it&rsquo;s own build system to C++ modules - <strong>node-gyp</strong>.</p><p>There is a .gyp file which contains build options of your module. A GYP file is looks like JSON-like file where you specify your build targets.</p><p><strong><em>binding.gyp</em></strong></p><pre><code>{
  &quot;targets&quot;: [
    {
      &quot;target_name&quot;: &quot;cv&quot;,
      &quot;sources&quot;: [ &quot;main.cpp&quot; ],
      &quot;include_dirs&quot;: [ &quot;/users/BloodAxe/Develop/opencv-node-bin/lib/inlcude/&quot; ],  
      &quot;link_settings&quot;: {
                        'libraries':    ['-lopencv_core -lopencv_features2d -lopencv_contrib'],
                        'library_dirs': ['/users/BloodAxe/Develop/opencv-node-bin/lib/'],
                       },
    }
  ]
}
</code></pre><p>Let&rsquo;s look at it in more details:</p><ul><li>We define a single target with name <code>cv</code>.</li><li>The target includes a single source file <code>main.cpp</code>.</li><li>We adjust <code>include_dirs</code> and <code>link_settings</code> options to point our static OpenCV build.</li></ul><p>Second mandatory file is package.json - it contains meta-information about our module:</p><p><strong>package.json</strong></p><pre><code>{
    &quot;name&quot;: &quot;cv&quot;,
    &quot;version&quot;: &quot;1.0.0&quot;,
    &quot;main&quot;: &quot;./build/Release/cv&quot;
}
</code></pre><p>Finally, a source code of our module. For sake of simplicity, let&rsquo;s export a single function that prints OpenCV build information from Node.js:</p><p><strong>main.cpp</strong></p><p>To build your module you can write the following command (assuming your current directory contains binding.gyp):</p><pre><code>npm build .
</code></pre><p>If you see the following output - your Node.js module that uses OpenCV has been built!</p><p>Now it&rsquo;s time to check how it works.</p><p>Here is a simple run script:</p><p><strong><em>run.js</em></strong></p><pre><code>var cv = require('./build/Release/cv');

console.warn(cv.buildInformation());
</code></pre><p>To run it:</p><pre><code>node run.js
</code></pre><h2 id=summary>Summary</h2><p>I hope after reading this post you understood how to write a simple OpenCV wrapper for Node.js. In the next tutorial i will show how to perform simple image processing inside our Node module. Your comments for this post are welcome!</p><p>You can find an bare minimum Node.js module example here: <strong><a href=https://github.com/BloodAxe/CloudCV/tree/bare-minimum>OpenCV module for Node.js</a></strong>.</p></div><div class=post__footer><span><a class=tag href=/tags/opencv/>opencv</a><a class=tag href=/tags/nodejs/>nodejs</a><a class=tag href=/tags/cloudcv/>cloudcv</a><a class=tag href=/tags/cloud-computing/>cloud-computing</a></span></div><div id=comment><h2>comments</h2><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//cvtalks.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Eugene Khvedchenya
2022</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.9c062c557275acbaba71f0c7cd4024da3e3cc825d248bc4b2130811b0965330b.js integrity="sha256-nAYsVXJ1rLq6cfDHzUAk2j48yCXSSLxLITCBGwllMws=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-10687369-5","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>